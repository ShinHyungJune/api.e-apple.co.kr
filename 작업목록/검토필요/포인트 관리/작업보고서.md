# 포인트 관리 오류 수정 보고서

## 작업 일자
2025-09-12

## 문제 설명
Point 모델에서 "Attempt to read property merchant_uid on null" 오류 발생
- 파일: `/home/forge/api.e-apple.co.kr/app/Models/Point.php`
- 라인: 70번째 줄

## 원인 분석
### 문제 원인
`getOrderIdAttribute()` 메소드에서 pointable 관계가 null일 수 있음에도 null 체크 없이 속성에 접근

### null이 발생하는 경우
1. pointable_type, pointable_id가 데이터베이스에서 nullable로 정의됨
2. 관련된 Order나 ProductReview가 삭제된 경우
3. 시스템에서 직접 포인트 지급 시 pointable 없이 생성
4. 이벤트나 관리자 지급 등 주문과 무관한 포인트 적립

## 수정 사항

### Point.php 수정 완료
**파일**: `api.e-apple.co.kr/app/Models/Point.php`
**수정 내용**: null 체크 로직 추가 및 커밋 완료

```php
public function getOrderIdAttribute()
{
    if ($this->pointable_type === Order::class && $this->pointable) {
        return $this->pointable->merchant_uid;
    }

    if ($this->pointable_type === ProductReview::class && $this->pointable) {
        return $this->pointable?->order?->merchant_uid;
    }

    return null;
}
```

## 수정 내용
- 69번째 줄: Order 타입일 때 `&& $this->pointable` 조건 추가
- 73번째 줄: ProductReview 타입일 때 `&& $this->pointable` 조건 추가  
- 77번째 줄: 명시적으로 `return null;` 추가

## 영향 범위
### API 응답
- `PointResource`: order_id 필드가 null 반환 가능
- `PointController`: append('order_id') 정상 동작

### 데이터베이스
- pointable이 null인 기존 데이터 정상 처리
- 새로운 시스템 포인트 적립 시 오류 없이 처리

## 테스트 항목
1. pointable이 있는 포인트의 order_id 정상 표시
2. pointable이 null인 포인트 조회 시 오류 없음
3. 시스템 포인트 적립 정상 동작
4. 포인트 목록 API 응답 정상

## 결과
Point 모델의 null 체크 로직 수정 완료
- 커밋 ID: 63ea505
- 커밋 메시지: "Fix: Point 모델 merchant_uid null 참조 오류 수정"