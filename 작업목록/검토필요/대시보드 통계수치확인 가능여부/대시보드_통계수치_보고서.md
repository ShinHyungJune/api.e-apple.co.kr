# 대시보드 통계수치 기능 구현 보고서

## 작업 개요
관리자 대시보드에서 방문자수, 매출액, 주문 관련 통계를 볼 수 있는 API 구현

## 구현 내용

### 1. 방문자 기록 시스템 구축
- **visitor_logs 테이블 생성** (migration)
  - IP 주소, User Agent, 경로, 사용자 ID, 방문 날짜 저장
  - 하루에 같은 IP는 한 번만 카운트

- **VisitorLog 모델 생성**
  - 방문자 로그 데이터 관리

- **LogVisitor 미들웨어 구현**
  - 모든 API 요청 시 자동으로 방문자 기록
  - 관리자 API는 제외 (사용자 API만 기록)

### 2. 대시보드 통계 API 구현
- **DashboardController 생성**
  - `/api/admin/dashboard/statistics` 엔드포인트

### 3. 제공되는 통계 데이터
1. **최근 30일 일일 방문자수** (daily_visitors)
   - 날짜별 유니크 방문자 수
   - 데이터가 없는 날짜는 0으로 표시

2. **최근 30일 일일 매출액** (daily_sales)  
   - 날짜별 결제 완료된 주문의 총액
   - 데이터가 없는 날짜는 0으로 표시

3. **오늘의 주문건수** (today_order_count)
   - 오늘 들어온 유효한 주문 수

4. **오늘의 주문액** (today_order_amount)
   - 오늘 결제 완료된 주문의 총액

5. **전체 방문자수** (total_visitors)
   - 최근 30일간 총 유니크 방문자 수

6. **전체 매출액** (total_sales)
   - 최근 30일간 총 매출액

## 수정한 파일
- database/migrations/2025_09_07_135618_create_visitor_logs_table.php
- app/Models/VisitorLog.php
- app/Http/Middleware/LogVisitor.php
- app/Http/Controllers/Api/Admin/DashboardController.php
- routes/admin.php
- bootstrap/app.php (미들웨어 등록)

## API 사용 방법
```
GET /api/admin/dashboard/statistics
Authorization: Bearer {admin_token}
```

### 응답 예시
```json
{
  "success": true,
  "data": {
    "daily_visitors": [
      {"date": "2025-08-09", "visitors": 125},
      {"date": "2025-08-10", "visitors": 132},
      ...
    ],
    "daily_sales": [
      {"date": "2025-08-09", "sales": 2500000},
      {"date": "2025-08-10", "sales": 3200000},
      ...
    ],
    "today_order_count": 45,
    "today_order_amount": 5670000,
    "total_visitors": 3250,
    "total_sales": 85000000,
    "period": {
      "start": "2025-08-09",
      "end": "2025-09-07"
    }
  }
}
```

## 특징
- 방문자는 IP 기준으로 하루 1회만 카운트
- 매출 통계는 결제 완료된 주문만 포함
- 날짜별 데이터는 최근 30일간 제공
- 데이터가 없는 날짜도 0으로 표시하여 그래프 그리기 용이

## 주의사항
- 마이그레이션 실행 필요: `php artisan migrate`
- 방문자 기록은 API 요청 시 자동으로 수집됨
- 관리자 페이지 접속은 방문자로 카운트하지 않음